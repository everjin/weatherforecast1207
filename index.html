<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ê¸°ë„ ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .select-container {
            position: relative;
            margin-bottom: 30px;
        }

        select {
            width: 100%;
            padding: 15px 20px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            padding-right: 50px;
        }

        select:hover {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        button {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .weather-info {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        .weather-info.show {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .weather-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .city-name {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .current-time {
            font-size: 16px;
            color: #666;
        }

        .weather-main {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .weather-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
        }

        .weather-card.large {
            grid-column: 1 / -1;
            padding: 30px;
        }

        .weather-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .temperature {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .weather-status {
            font-size: 24px;
            color: #333;
            font-weight: 600;
        }

        .weather-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .weather-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: #ffeaea;
            border-radius: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }

            .weather-main {
                grid-template-columns: 1fr;
            }

            .weather-card.large {
                grid-column: 1;
            }

            .weather-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ ê²½ê¸°ë„ ë‚ ì”¨</h1>
        
        <div class="select-container">
            <select id="citySelect">
                <option value="">ì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="60,121">ìˆ˜ì›ì‹œ</option>
                <option value="56,129">ê³ ì–‘ì‹œ</option>
                <option value="65,118">ìš©ì¸ì‹œ</option>
                <option value="63,124">ì„±ë‚¨ì‹œ</option>
                <option value="58,125">ë¶€ì²œì‹œ</option>
                <option value="59,123">ì•ˆì–‘ì‹œ</option>
                <option value="58,121">ì•ˆì‚°ì‹œ</option>
                <option value="57,114">í‰íƒì‹œ</option>
                <option value="61,130">ì˜ì •ë¶€ì‹œ</option>
                <option value="58,123">ì‹œí¥ì‹œ</option>
                <option value="62,126">ê´‘ëª…ì‹œ</option>
                <option value="64,119">í•˜ë‚¨ì‹œ</option>
            </select>
        </div>

        <button id="getWeatherBtn" onclick="getWeather()">ë‚ ì”¨ ì¡°íšŒí•˜ê¸°</button>

        <div id="weatherInfo" class="weather-info">
            <div class="weather-header">
                <div class="city-name" id="cityName"></div>
                <div class="current-time" id="currentTime"></div>
            </div>

            <div class="weather-main">
                <div class="weather-card large">
                    <div class="weather-icon" id="weatherIcon">ğŸŒ¤ï¸</div>
                    <div class="temperature" id="temperature">--</div>
                    <div class="weather-status" id="weatherStatus">--</div>
                </div>
            </div>

            <div class="weather-details">
                <div class="detail-item">
                    <div class="weather-label">ìŠµë„</div>
                    <div class="weather-value" id="humidity">--</div>
                </div>
                <div class="detail-item">
                    <div class="weather-label">ê°•ìˆ˜í™•ë¥ </div>
                    <div class="weather-value" id="pop">--</div>
                </div>
                <div class="detail-item">
                    <div class="weather-label">í’ì†</div>
                    <div class="weather-value" id="windSpeed">--</div>
                </div>
                <div class="detail-item">
                    <div class="weather-label">ê°•ìˆ˜í˜•íƒœ</div>
                    <div class="weather-value" id="pty">--</div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        // ê²½ê¸°ë„ ì£¼ìš” ì‹œì˜ ê²©ì ì¢Œí‘œ ì •ì˜
        const cityCoordinates = {
            'ìˆ˜ì›ì‹œ': { nx: 60, ny: 121 },
            'ê³ ì–‘ì‹œ': { nx: 56, ny: 129 },
            'ìš©ì¸ì‹œ': { nx: 65, ny: 118 },
            'ì„±ë‚¨ì‹œ': { nx: 63, ny: 124 },
            'ë¶€ì²œì‹œ': { nx: 58, ny: 125 },
            'ì•ˆì–‘ì‹œ': { nx: 59, ny: 123 },
            'ì•ˆì‚°ì‹œ': { nx: 58, ny: 121 },
            'í‰íƒì‹œ': { nx: 57, ny: 114 },
            'ì˜ì •ë¶€ì‹œ': { nx: 61, ny: 130 },
            'ì‹œí¥ì‹œ': { nx: 58, ny: 123 },
            'ê´‘ëª…ì‹œ': { nx: 62, ny: 126 },
            'í•˜ë‚¨ì‹œ': { nx: 64, ny: 119 }
        };

        const API_KEY = 'OaRLlfpKOXJH%2BFeghkAojoaSAQbb1bkFF9COvGfjixpiLkEYTHFLqIcBYqFb0HCrcX8H3A47X9QNiRpgcCXAOA%3D%3D';
        const BASE_URL = 'https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst';

        // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ base_dateì™€ base_time ê³„ì‚°
        function getBaseDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = now.getHours();
            const minute = now.getMinutes();

            // ê¸°ìƒì²­ APIëŠ” ë§¤ì¼ 02, 05, 08, 11, 14, 17, 20, 23ì‹œì— ë°œí‘œ
            // í˜„ì¬ ì‹œê°„ë³´ë‹¤ ì´ì „ì˜ ê°€ì¥ ìµœê·¼ ë°œí‘œ ì‹œê°„ì„ ì°¾ìŒ
            const baseTimes = [2, 5, 8, 11, 14, 17, 20, 23];
            let baseTime = '0200';
            let baseDate = `${year}${month}${day}`;

            for (let i = baseTimes.length - 1; i >= 0; i--) {
                if (hour >= baseTimes[i] || (hour === baseTimes[i] && minute >= 0)) {
                    baseTime = String(baseTimes[i]).padStart(2, '0') + '00';
                    break;
                }
            }

            // ìì • ì´ì „ ì‹œê°„ì´ë©´ ì „ë‚  23ì‹œ ë°ì´í„° ì‚¬ìš©
            if (hour < 2) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                baseDate = `${yesterday.getFullYear()}${String(yesterday.getMonth() + 1).padStart(2, '0')}${String(yesterday.getDate()).padStart(2, '0')}`;
                baseTime = '2300';
            }

            return { baseDate, baseTime };
        }

        // ë‚ ì”¨ ìƒíƒœì— ë”°ë¥¸ ì•„ì´ì½˜ ë°˜í™˜
        function getWeatherIcon(sky, pty) {
            if (pty === '1' || pty === '2' || pty === '4') return 'ğŸŒ§ï¸';
            if (pty === '3') return 'â„ï¸';
            if (sky === '1') return 'â˜€ï¸';
            if (sky === '3') return 'â›…';
            if (sky === '4') return 'â˜ï¸';
            return 'ğŸŒ¤ï¸';
        }

        // ê°•ìˆ˜í˜•íƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getPtyText(pty) {
            const ptyMap = {
                '0': 'ì—†ìŒ',
                '1': 'ë¹„',
                '2': 'ë¹„/ëˆˆ',
                '3': 'ëˆˆ',
                '4': 'ì†Œë‚˜ê¸°'
            };
            return ptyMap[pty] || '--';
        }

        // í•˜ëŠ˜ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getSkyText(sky) {
            const skyMap = {
                '1': 'ë§‘ìŒ',
                '3': 'êµ¬ë¦„ë§ìŒ',
                '4': 'íë¦¼'
            };
            return skyMap[sky] || '--';
        }

        // API í˜¸ì¶œ ë° ë‚ ì”¨ ì •ë³´ í‘œì‹œ
        async function getWeather() {
            const citySelect = document.getElementById('citySelect');
            const selectedValue = citySelect.value;

            if (!selectedValue) {
                alert('ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const [nx, ny] = selectedValue.split(',').map(Number);
            const selectedCity = citySelect.options[citySelect.selectedIndex].text;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('weatherInfo').classList.remove('show');
            document.getElementById('error').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('getWeatherBtn').disabled = true;

            try {
                const { baseDate, baseTime } = getBaseDateTime();
                const url = `${BASE_URL}?serviceKey=${API_KEY}&numOfRows=100&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${nx}&ny=${ny}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.response?.header?.resultCode !== '00') {
                    throw new Error(data.response?.header?.resultMsg || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const items = data.response.body.items.item;
                if (!items || items.length === 0) {
                    throw new Error('ë‚ ì”¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                // í˜„ì¬ ì‹œê°„ì— ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„° ì¶”ì¶œ
                const now = new Date();
                const currentHour = String(now.getHours()).padStart(2, '0');
                const currentMinute = String(now.getMinutes()).padStart(2, '0');
                const currentTimeStr = `${currentHour}${currentMinute}`;

                // fcstDateì™€ fcstTimeì´ í˜„ì¬ ì‹œê°„ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„° ì°¾ê¸°
                let weatherData = {
                    TMP: null,  // ê¸°ì˜¨
                    REH: null,  // ìŠµë„
                    SKY: null,  // í•˜ëŠ˜ìƒíƒœ
                    PTY: null,  // ê°•ìˆ˜í˜•íƒœ
                    POP: null,  // ê°•ìˆ˜í™•ë¥ 
                    WSD: null   // í’ì†
                };

                // í˜„ì¬ ì‹œê°„ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ì˜ˆë³´ ì‹œê°„ ì°¾ê¸°
                const forecastTimes = ['00', '03', '06', '09', '12', '15', '18', '21'];
                let targetFcstTime = '00';
                
                for (let i = forecastTimes.length - 1; i >= 0; i--) {
                    const time = parseInt(forecastTimes[i]);
                    if (now.getHours() >= time) {
                        targetFcstTime = forecastTimes[i];
                        break;
                    }
                }

                const today = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;

                items.forEach(item => {
                    if (item.fcstDate === today && item.fcstTime === targetFcstTime + '00') {
                        if (weatherData[item.category] === null) {
                            weatherData[item.category] = item.fcstValue;
                        }
                    }
                });

                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê°€ì¥ ìµœê·¼ ë°ì´í„° ì‚¬ìš©
                if (!weatherData.TMP) {
                    const firstItem = items.find(item => item.category === 'TMP');
                    if (firstItem) {
                        const targetDate = firstItem.fcstDate;
                        const targetTime = firstItem.fcstTime;
                        items.forEach(item => {
                            if (item.fcstDate === targetDate && item.fcstTime === targetTime) {
                                if (weatherData[item.category] === null) {
                                    weatherData[item.category] = item.fcstValue;
                                }
                            }
                        });
                    }
                }

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('cityName').textContent = selectedCity;
                document.getElementById('currentTime').textContent = 
                    `ì—…ë°ì´íŠ¸: ${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${currentHour}:${currentMinute}`;
                
                document.getElementById('temperature').textContent = 
                    weatherData.TMP ? `${weatherData.TMP}Â°C` : '--';
                
                document.getElementById('humidity').textContent = 
                    weatherData.REH ? `${weatherData.REH}%` : '--';
                
                document.getElementById('pop').textContent = 
                    weatherData.POP ? `${weatherData.POP}%` : '--';
                
                document.getElementById('windSpeed').textContent = 
                    weatherData.WSD ? `${weatherData.WSD}m/s` : '--';
                
                document.getElementById('pty').textContent = 
                    getPtyText(weatherData.PTY || '0');
                
                const skyStatus = weatherData.SKY || '1';
                const ptyStatus = weatherData.PTY || '0';
                document.getElementById('weatherStatus').textContent = 
                    ptyStatus !== '0' ? getPtyText(ptyStatus) : getSkyText(skyStatus);
                
                document.getElementById('weatherIcon').textContent = 
                    getWeatherIcon(skyStatus, ptyStatus);

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('weatherInfo').classList.add('show');
                document.getElementById('getWeatherBtn').disabled = false;

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 
                    `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
                document.getElementById('getWeatherBtn').disabled = false;
            }
        }

        // Enter í‚¤ë¡œë„ ì¡°íšŒ ê°€ëŠ¥
        document.getElementById('citySelect').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getWeather();
            }
        });
    </script>
</body>
</html>

